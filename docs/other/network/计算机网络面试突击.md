



## OSI参考模型

**1.物理层**

只识别0/1信号，是比特流与电信号的切换

**2.数据链路层**

数据帧与比特流之间的转换

**3.网络层**

进行地址管理以及路由选择。比如通过哪个路由能达到目标地址

**4.传输层**

管理两节点之间的数据传输，要保证可靠传输

**5.会话层**

通信管理，负责建立和断开通信连接

**6.表示层**

接收并表示各种格式的信息

**7.应用层**

特定应用有特定的协议。如电子邮件，文件传输等

## TCP/IP分层模型

**1.硬件**

对应物理层

**2.网卡层**

对应数据链路层

**3.互联网层**

ARP、IP、ICMP协议

**ARP：**从分组数据包的IP地址解析出MAC地址

**IP：**跨越网络的数据包

**ICMP：**检测IP数据包发送时是否发生异常，发生的话给发送端返回通知

**4.传输层**

TCP、UDP

**TCP：**面向连接的传输协议，保证两端主机之间的通信可达。能处理传输的过程中丢包、乱序的问题(三次握手，四次挥手)

**UDP：**面向无连接的传输协议，不关注接收端是否接受到数据，主要用于音视频的传输，比如直播

**5.应用层**

![image](https://tva3.sinaimg.cn/large/0085EwgIgy1godq2sh8cej30ih0cw78o.jpg)

## 计算机网络体系结构

### 概述

#### 计算机网络的概念

互联、自洽的计算机系统的集合

#### 分类

>1.广域网(WAN)
>
>2.局域网(LAN)
>
>3.个人局域网(PAN)

#### 拓扑结构

1.总线型：一条总线，连接所有的主机

![image](https://tva1.sinaimg.cn/large/0085EwgIgy1godrijepmej306b0550so.jpg)

2.星型：一个中央设备机连接着所有的主机

![image](https://tvax3.sinaimg.cn/large/0085EwgIgy1godrj6e5wdj305204j3yh.jpg)

3.环形：所有主机环绕形成一份圈，信号单向传输，应用在令牌网

![image](https://tva3.sinaimg.cn/large/0085EwgIgy1godrkg4u0vj305h04w74a.jpg)



4.网状形：一个节点主机至少有两个节点相连，应用在广域网中

![image](https://tva4.sinaimg.cn/large/0085EwgIgy1godrlbrnthj305l05at8p.jpg)

#### 交换技术

1.电路交换

>源节点和目标节点通过一条通路进行信息交换，包括了建立连接，传输数据，断开连接的过程、
>
>优点：传播时延小
>
>缺点：线路利用率低，只能某两节点断开了，其他才能继续数据传输；
>
>​			不能进行差错控制

2.报文交换

>将用户发送的信息，加上源节点，目标节点，校验码等，封装成报文。整个报文发送到目标节点后，需要全部存储，再查看转发表，转发给下一个节点。所以也成为存储-转发网络。
>
>优点：充分利用线路 ，可实现差错控制
>
>缺点：需要额外的存储空间；缓冲难以管理，因为没有限定报文的大小，无法知道是否已经传输结束

3.分组交换

>将数据包分成相等大小的数据块，在每个数据块中加上目的地址、源地址等，再进行存储转发
>
>优点：提高了线路的利用率；差错控制；易于缓冲管理，因为数据块的大小是确定的；包的平均时延更小，不需要等全部报文都存储成功再转发，每个数据块存储成功即可转发

#### 性能指标

1.带宽

单位：b/s 比特每秒。每秒能传输的比特位。表示传输的速率

2.时延

>数据(报文或者分组)从发送端到接收端需要的时间。
>
>组成：发送时延，传播时延，处理时延，排队时延。
>
>**发送时延：**数据从准备到可以发送所需要的时间。
>
>**传播时延：**电磁波在信道中的传播时间。这是无法改变的。
>
>因为传播时延=信道长度/电磁波速度
>
>**排队时延：**分组在进入路由器后在输入队列中等待
>
>**处理时延：**在交换节点中进行分发处理需要进行的操作

3.时延带宽积

>发送端发送第一个即将到达终点时，发送端已经发送了多少比特。
>
>时延带宽积=传播时延x信道带宽，很类似速度(信道带宽)*时间(传播时延)

4.往返时延(RTT)

>从发送端发送到发送端接收到接收端发送的确认，所需要的时间

5.吞吐量：单位时间内通过信道的数据量

6.信道利用率：有数据通过的时间/有数据通过的时间+无数据通过的时间

### 分层模型

#### OSI七层参考模型

1.物理层

2.数据链路层

传输单位为帧，将网络层的数据报转换成帧。

3.网络层

传输单位为数据报。实现对数据报的分发

4.传输层

传输单位为报文段或者用户数据段

5.会话层

允许不同主机之间的进程进行会话。

6.表示层

将数据进行表示

7.应用层

#### TCP/IP模型

**1.网络接口层**

相当于物理层、数据链路层

**2.网际层**

相当于网络层

**3.传输层**

相当于传输层

**4.应用层**

相当于会话层、表示层、应用层

## 物理层

### 电路交换

建立连接前，两节点之间需要建立独占的信道，这个信道只能由两个节点占有。

电路交换分成三个部分：连接建立、数据传输、连接释放

>优点：
>
>1.时延小
>
>2.实现简单
>
>3.没有冲突
>
>4.可保证有序传输

>缺点：
>
>1.可拓展性差
>
>2.建立连接时间长
>
>3.信道独占，利用率低

### 报文交换

将信息携带上源地址，目的地址，封装成报文。**无需建立连接**，在每个交换节点要进行存储转发

>优点：
>
>1.无需建立连接
>
>2.线路可靠性好，如果该线路发生故障，可选择其他的线路
>
>3.线路利用率高
>
>缺点：
>
>1.由于存储转发，产生的时延(检查正确性、排队)会很高
>
>2.对报文的大小没有限制，对缓冲区很不友好

### 分组交换

将数据分成大小相同的数据块，携带上源地址，目的地址，序号。

其他和报文交换一致

>优点：
>
>1.无需建立连接
>
>2.保证了有序性
>
>3.减小出错和重发的概率
>
>缺点：
>
>1.需要额外的空间
>
>

## 数据链路层

帧：对数据加上头部和尾部，就变成了数据帧

>功能：
>
>1.流量控制
>
>协调发送方发送速度与接收方接受速度的差异。
>
>2.差错控制
>
>由于噪声的存在，可能会让数据帧出现位差错。需对其进行校验
>
>3.帧定界
>
>将数据化成以帧为单位，容易对差错进行排查

### 差错控制

方法：

>1.奇偶校验码
>
>n-1位数据元+校验码
>
>奇校验码：添加校验码后使得1的个数位奇数
>
>偶检验码：添加校验码后使得1的个数为偶数
>
>2.循环冗余码
>
>3.纠错编码：汉明码

### 流量控制与可靠传输

>1.停止-等待
>
>发送方每次发送一帧，都需要等待接收方的响应，才能继续发送。
>
>相当于发送窗口和接收窗口都是1的滑动窗口
>
>否则只能一直等待
>
>2.后退N帧
>
>发送方可以发送N个帧而不用像停止-等待那样。
>
>接收端检测到错误时，会让发送方发送该帧以及之后的所有帧；或者发送方发送了N个帧后，检测到这N个帧的前一个帧的确认信息已经超时，那么就发送该帧以及之后的所有帧
>
>3.选择重传
>
>发送方和接受方的滑动窗口均大于1，而发送窗口小于等于接收窗口。
>
>接收方对于出错的帧只需要求发送方发送该帧，而不是像后退N帧那样，发送该帧以及之前的所有帧。

### 介质访问控制

#### 信道划分介质访问控制

解决同一信道上，不同信源进行通信时进行隔离，不会被干扰。

多路复用技术：将输入信息整合到一条信道上

![image](https://tvax2.sinaimg.cn/large/0085EwgIgy1godvxd7i3tj30go062jsd.jpg)

1.频分多路复用

![image](https://tvax4.sinaimg.cn/large/0085EwgIgy1godwbdct65j30da07w75y.jpg)

将多个信号，调制到不同的频率上，再复合成一个复合信号

虽然能一次传输多个信号，但是复合起来的信号总和是不能超过信道的带宽的。

2.时分多路复用

![image](https://tvax1.sinaimg.cn/large/0085EwgIgy1godweeqym9j30e108840d.jpg)



一个时间片内，信息等分的顺序发送。不同时间片之间，传输的顺序都是一样的

3.波分多路复用

![image](https://tvax1.sinaimg.cn/large/0085EwgIgy1godwg09n3vj30hy07z40a.jpg)

相当于光的频分多路复用。按照将信号转成不同的波长，复合成一个光信号。

4.码分多路复用

![image-20210309200322900](C:\Users\daniel\AppData\Roaming\Typora\typora-user-images\image-20210309200322900.png)

信号一同运输，只在结果处，通过编码来区分不同的信号。

区分方式：码分多址

#### 随机访问介质访问控制

性质：不集中控制用户发送的信号，能根据自己的意愿随机发送信息。

为了解决碰撞问题，需要反复重传帧。

**1.ALOHA协议**

发送方不检查的发送，当超过一定时间后就认为发生了碰撞，选择重新发送。

但是发生了碰撞的并不能马上重传，从而导致碰撞的继续发生。因此ALOHA协议在重传时规定随机等待一段时间

**2.时隙ALOHA协议**

将时间同步起来，并划分成时隙，规定只有在时隙开始的时候，才能发送一个帧，进少了碰撞发生的概率

**3.CSMA协议：载波侦听多路访问**

>CSMA协议：每个信源发送信号时，都要对信道进行监听。
>
>1-坚持CSMA：持续监听信道，忙则等待，不忙时马上发送
>
>非坚持CSMA：空闲则发送，忙则随机时间后在监听
>
>p-坚持CSMA：忙则监听，空闲的话以p的概率发送，1-p的概率不发送

**4.CSMA/CD协议**

载波侦听多路访问/碰撞检测

先监听信道后再发，发的时候要一直监听。遇到冲突就停止发送，然后随机一段时间后重新发送

**5.CSMA/CA协议**

载波侦听多路复用/碰撞避免


## 网络层

功能：将异构的网络进行互联，从而能够通信

### 路由与转发

>路由器的功能：
>
>1.路由选择
>
>通过路由选择协议构造出路由表。路由表需要不断进行维护
>
>2.分组转发
>
>按照路由表，将数据报从正确的端口进行转发出去

### 路由算法

>1.静态路由算法
>
>网络管理员手动配置路由信息。
>
>2.动态路由算法
>
>通过相互连接的路由器交换信息，再经过算法处理得到
>
>3.距离-向量路由算法
>
>所有相连的路由器定期向相连接的路由器发送自己所有能达到的节点的跳数。然后进行对比，如果不存在的话就加入某条信息；如果步长更小的话就更新。例如RIP算法
>
>4.链路状态路由算法
>
>只有当某路由的状态发生变化时，即链路状态发生了变化，路由器会检查和它所连接的路由器的状态，然后发送给所有其他不是直接相连的路由器。接着路由器通过迪杰斯特拉算法计算出到其他所欲路由的最小路径。
>
>链路状态路由算法的优点在于，最短路径的计算不依赖于中间节点；寻找故障也会更加方便；而距离-向量算法可能会遇到路由环路的问题。

### IPv4

![image](https://tva4.sinaimg.cn/large/0085EwgIgy1gody4h107bj30l00cx0w9.jpg)

>1.总长度：头部与数据总长。当超过1500字节时，需要对数据报进行分片。
>
>2.标志：
>
>有MF和DF。
>
>MF = 1，后面还有分片
>
>MF = 0 ，后面没有分片
>
>DF = 1，允许分片
>
>DF= 0， 不允许分片
>
>3.片漂移：是八的整数倍，表明相对于原来的数据包中的位置
>
>4.生存时间：在网络中能通过的路由器的最大值，每经过一次路由器就减一。保证数据报不会在网络中死循环。
>
>5.首部检验和。
>
>6.源IP地址
>
>7.目的IP地址

### IP地址

![image](https://tva2.sinaimg.cn/large/0085EwgIgy1godyny4q2jj30iv08jaci.jpg)

>A类地址：首位为0，网络号的长度为8位。由于规定了网络号首位为0，而且全0和全1的网络号分别代表本网络和换回测试地址，所以可用的网络号个数为(2^7)-1。范围:( 1- 126)；可用主机号为(2^24)-2,减2是去掉了全零和全一
>
>B类地址：首位为10，网络号长度为16为，可用的网络号个数为(2^14) - 1.减一是因为128.0这个网络号是不可指派的。网络号范围(128 ~ 191)，可用主机号为
>
>2^16 -2.
>
>C类地址：首位为110，网络号长度为24位。可用的网络号数位(2^ 21 - 1),因为192.0.0是不可指派的。可用主机数为(2^8) -2 

![image](https://tva4.sinaimg.cn/large/0085EwgIgy1godz0pwph9j30no05jabw.jpg)

>A类：1.0.0.0 ~ 126.255.255.255，**127.0.0.0 ~ 127.255.255.255不能使用**
>
>B类：128.1.0.0 ~ 191.255.255.255，**128.0.0.0 ~ 128.0.255.255不能使用**
>
>C类：192.0.1.0 ~ 223.255.255.255，**192.0.0.0 ~  192.0.0.255不能使用**

>私有IP地址：也叫做可重用地址
>
>A类：10.0.0.0 ~ 10.255.255.255
>
>B类：172.16.0.0 ~ 172.31.255.255
>
>C类：192.168.0.0 ~ 192.168.255.255

### ARP

地址解析协议

>主机A需要发送IP数据报给主机B时，先从ARP高速缓存表中查找主机B的IP地址。有的话直接完善数据报然后发送；没有的话就要使用目的MAC地址为FF-FF-FF-FF的数据报来发送广播，使得局域网内都收到请求。主机B收到后响应，返回主机B的IP和MAC地址的映射关系，主机A收到后，写入高速缓存表，然后完善数据爆再发送。

### DHCP(应用层的协议)

动态主机配置协议

>给主机动态的分配IP地址。
>
>需要IP地址的主机向DHCP服务器发送请求报文，本地网络上的所有主机都能收到报文，只有DHCP服务器能响应该报文。DHCP服务器先在数据库中寻找主机的信息，找到的话就返回，找不到的话就从IP地址池中分配一个。
>
>DHCP服务器分配的地址是会过期的

### ICMP

让主机或者路由器能报告IP数据报的差错信息

>ICMP报文分两种：
>
>1.ICMP差错报告报文
>
>2.ICMP询问报文(不重要)



>ICMP差错控制报文：
>
>1.终点不可达
>
>2.源点抑制
>
>3.时间超过
>
>4.参数问题
>
>5、重定向



### RIP

>基于距离-向量路由算法的协议。
>
>1.跳数最多为15，为16时代表无穷远
>
>2.默认每30s，相邻的路由器广播一次自己的路由信息
>
>3.如果180s还未收到相邻的路由器的更新信息，就把相邻的路由器的距离设为16

### OSPF

基于链路状态路由算法

具体看上面的链路状态路由算法.



### BGP

边界网关协议。外部协议，不是在同一个自治系统中进行。

每个自治系统选择一个或多个发言人，和其他自治系统的发言人建立TCP连接来交换路由表信息。

![image](https://tva3.sinaimg.cn/large/0085EwgIgy1goe0ej17y1j30mm077myq.jpg)

## 传输层

功能：

>1.提供进程之间的逻辑通信
>
>2.为应用程序提供可靠服务
>
>3.对数据报进行首部和数据部分的差错控制
>
>而网络层只对头部进行差错控制



>数据链路层的服务访问点是MAC地址
>
>网络层的服务访问点是IP地址
>
>传输层的服务访问点是端口号，通过端口号，使得应用能和进程一一对应。

### 套接字

![image](https://tvax2.sinaimg.cn/large/0085EwgIgy1goe0lqe6wuj30mn07xac1.jpg)

### 可靠连接与非可靠连接

可靠连接：TCP

特点：

>1.面向连接。传输数据：建立连接->传输数据->断开连接
>
>俗称 三次握手，四次挥手
>
>2.全双工通信
>
>3.用于文件传输协议(FTP)，超文本传输协议(HTTP)，远程登录(TELENT)

非可靠链接：UDP

特点：

>1.无连接
>
>2.无需任何确认
>
>3.应用于小文件传输(TFTP)，DNS，SNMP和实时传输协议(RTP)
>
>4.面向报文

### UDP

数据报格式：

![image](https://tva2.sinaimg.cn/large/0085EwgIgy1goe0so2n00j30k206qt93.jpg)

UDP校验：

计算校验和之前，先在UDP头部加上12字节的伪头部，计算结束后就再无用处。校验和方法：二进制反码求和再取反。

UDP的校验会检查头部和数据，IP只会检查头部

### TCP

>1.需要建立连接
>
>2.保证可靠的交付，保证不乱序，不丢失，无差错
>
>3.全双工通信
>
>4.面向字节流

![image](https://tva4.sinaimg.cn/large/0085EwgIgy1goe0whsimlj30gd0ak0uf.jpg)

>1.序列号seq
>
>2.确认号ack
>
>3.同步号SYN，三次握手的前两次需要用到，用于建立连接。
>
>4.结束连接FIN，用于释放连接

#### 三次握手

![image](https://tvax2.sinaimg.cn/large/0085EwgIgy1goe11aqogjj30ke0d7mys.jpg)

用于建立连接：

>1.客户端发送seq = x, SYN = 1，表示需要建立连接，该报文的数据部分不含任何信息。
>
>2.ACK = 1，ack = x + 1，SYN = 1，seq = y，服务器响应连接请求，表示同意该连接请求，并为该TCP连接分配缓存和变量。
>
>3.ACK = 1，ack = y + 1, seq = x + 1,客户端收到确认后，还要恢复确认收到。
>
>

其中，服务器的资源是在第二次握手分配的，客户端的资源是第三次握手分配的，那么容易出现SYN泛洪攻击。即恶意请求连接，却不回复第三次握手，导致连接一直存在，并不断申请新的TCP连接，最终导致服务器宕机。

#### 四次挥手



![image](https://tva3.sinaimg.cn/large/0085EwgIgy1goe17hrb67j30hg0byabj.jpg)

用于进行释放TCP连接。

>1.客户端发送连接释放请求：seq = u, FIN = 1
>
>2.服务器收到释放请求，回复收到确认释放的请求：ack = u + 1，ACK = 1，seq = v
>
>此时客户端已经不能再向服务器发送信息，而服务器仍能向客户端发送信息
>
>3.服务器没有要发送给客户端的数据了，FIN = 1，ACK = 1，seq = w，ack = u + 1
>
>4.客户端收到连接释放的请求，回复确认收到，ACK = 1， ack = w + 1，seq = u + 1

**总结：**

三次握手：

>1.客户端: SYN = 1 , seq = x
>
>2.服务器：ACK = 1, ack = x + 1，SYN  = 1，seq = y
>
>3.客户端：ACK = 1, ack = y + 1，seq = x + 1

四次挥手：

>1.客户端：FIN  = 1， seq = u
>
>2.服务器：FIN = 1，ACK = 1，ack = u + 1，seq = v
>
>3.服务器：FIN = 1，ACK = 1，ack = u + 1，seq = w
>
>4.客户端：ack = w + 1, seq = u + 1, ACK = 1

#### 可靠传输

含义：保证接收方进程从缓存区读出的字节流与发送方发送的字节流

实现：

>1.将报文段视为字节流，给字节上编号，即seq
>
>![image](https://tvax2.sinaimg.cn/large/0085EwgIgy1goejkq7g7rj30ca03qwey.jpg)
>
>2.确认号ack表明希望接收到对方的下一个字节的序号。发送方会存储那些已经发送但是还没收到确认的报文段，以便需要时重传。
>
>3.重传：超时重传和冗余ACK
>
>超时重传：为报文设置一个计时器，当超过时间后认为丢包，选择重新传输该报文段。
>
>冗余ACK：TCP规定当接收方收到的报文序号和期待的不一样时，就会发送期待的报文的前一个序号的冗余ACK，让发送方发送期待的报文段。
>
>比如发送方发送了1，2，3，4，5报文段。接收方收到了1，3，4，5.于是接收方发送三个1号的冗余ACK，表明自己收到了乱序的报文段，请补充缺少的报文段。

#### 流量控制

>含义：消除发送方可能导致接收方缓冲区溢出的可能。
>
>实现：使用滑动窗口的机制进行流量控制。发送方根据网络的拥塞程度规定拥塞窗口，接收方按自己的接受能力调整发送方的发送窗口大小，称为接收窗口。
>
>在建立连接时，接收方会声明接收窗口的大小。

![image-20210310094138556](C:\Users\daniel\AppData\Roaming\Typora\typora-user-images\image-20210310094138556.png)



#### 拥塞控制

含义：防止过度的数据注入到网络中而导致路由器或者链路过载，保证稳定性。

![image](https://tva4.sinaimg.cn/large/0085EwgIgy1goekg7gh1cj30jm055dhw.jpg)

实现：

**1.慢开始算法**

**2.拥塞避免**

**3.快重传**

**4.慢重传**

##### 慢开始和拥塞避免算法

>慢开始：开始时，客户端的拥塞窗口大小为最大报文段的两倍，那么发送端每次能发送两个TCP报文段。等收到两个报文的确认后，将拥塞窗口的大小调整为两倍。就这样一直增加拥塞窗口的大小，当到达阈值的时候，改用拥塞避免算法.
>
>拥塞避免算法：发送端拥塞窗口每完成一次RTT的确认，就让拥塞窗口加1，使得拥塞窗口线性增长，当出现一次超时的时候，让慢开始的阈值变成当前拥塞窗口的一半。

![image-20210310095514600](C:\Users\daniel\AppData\Roaming\Typora\typora-user-images\image-20210310095514600.png)

总结：

>1.首先使用慢开始算法，每次乘以二。
>
>2.达到阈值后改用拥塞避免算法，拥塞窗口每次加一
>
>3.出现网络拥塞时，将慢开始的阈值设为当前的一半，将拥塞窗口设为1，重新执行满开始算法

##### 快重传和快恢复算法

>快重传：当收到三个冗余ACK时，不再等待某个报文段的计时器超时，而是直接重传。
>
>快恢复：当收到三个冗余ACK时，将慢开始的阈值设为原来的一半，也将拥塞窗口的当前值设为慢开始阈值的一半，而不是像慢开始算法那样从1开始.

![image-20210310100009891](C:\Users\daniel\AppData\Roaming\Typora\typora-user-images\image-20210310100009891.png)

#### Time-wait和Close-wait

![image-20210310115318942](C:\Users\daniel\AppData\Roaming\Typora\typora-user-images\image-20210310115318942.png)



## 应用层

### 网络应用模型

**1.客户端/服务器模型**

**2.P2P模型**

![image](https://tvax2.sinaimg.cn/large/0085EwgIgy1goelui0r86j30ii06etal.jpg)

#### 客户端/服务器模型

>1.服务器处于保持接受请求的状态
>
>2.客户端发出请求，等待服务器返回结果
>
>3.服务器收到请求后，分析请求，将结果返回给客户端
>
>缺点：
>
>1.性能瓶颈在服务器，请求过多时，服务器压力大
>
>2.客户机之间不能直接通信

#### P2P模型

![image-20210310103715616](C:\Users\daniel\AppData\Roaming\Typora\typora-user-images\image-20210310103715616.png)

### 域名系统

网站url可以分为顶级域名，二级域名，三级域名等。

![image](https://tvax1.sinaimg.cn/large/0085EwgIgy1goem0jadukj307s03vq36.jpg)

顶级域名：

![image](https://tva2.sinaimg.cn/large/0085EwgIgy1goem2ogtfsj30k004p3zz.jpg)



#### 域名服务器

功能：域名->IP地址解析

模型：客户/服务器模型

**1.根域名服务器**

**2.顶级域名服务器**

**3.授权域名服务器**

**4.本地域名服务器**

根域名服务器：知道所有顶级域名服务器的IP地址，通常不会告诉本地域名服务器所查找的域名的IP地址，而是告诉本地域名服务器下一步该查找哪一个顶级域名服务器

#### 域名解析

正向解析：域名->IP地址

反向解析：IP地址->域名

解析方式：

1.递归查询

2.迭代与递归相结合

![image](https://tva2.sinaimg.cn/large/0085EwgIgy1goemg7jk03j30lx09racb.jpg)

##### 递归查询

>主机向本地域名服务器的查询采用递归查询的情况：
>
>所谓递归查询就是：如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，那么本地域名服务器就以DNS客户的身份，
>
>向其它根域名服务器继续发出查询请求报文(即替主机继续查询)，而不是让主机自己进行下一步查询。
>
>因此，递归查询返回的查询结果或者是所要查询的IP地址，或者是报错，表示无法查询到所需的IP地址。

##### 迭代查询

>迭代查询的特点：当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地服务器：“你下一步应当向哪一个域名服务器进行查询”。
>
>然后让本地服务器进行后续的查询。根域名服务器通常是把自己知道的顶级域名服务器的IP地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器查询。
>
>顶级域名服务器在收到本地域名服务器的查询请求后，要么给出所要查询的IP地址，要么告诉本地服务器下一步应当向哪一个权限域名服务器进行查询。
>
>最后，知道了所要解析的IP地址或报错，然后把这个结果返回给发起查询的主机

![image](https://tvax4.sinaimg.cn/large/0085EwgIgy1goemq413e8j30qi0bpdk5.jpg)

#### 协议

DNS使用TCP和UDP协议。在区域内传输时使用TCP，其他时间使用UDP。

例如辅域名服务器会定时地向主域名服务器发送查询请求，查看是否有数据地变更。发生变更时，就进行数据同步。数据同步使用TCP，因为数据量大，而且需要保证数据的可靠性。

### HTTP

超文本传输协议。定义了浏览器如何向服务器请求万维网文档，服务器怎么把万维网文档返回给浏览器。

#### 连接过程



服务过程：

>1.万维网站点不断监听服务器的TCP端口，等待浏览器的连接请求
>
>2.建立TCP连接
>
>3.浏览器发送HTTP请求报文
>
>4.服务器返回HTTP响应报文
>
>5.释放TCP连接

![image](https://tva2.sinaimg.cn/large/0085EwgIgy1goemzitlj0j30b505q74t.jpg)

例如：

访问某个网站的过程：![image](https://tvax3.sinaimg.cn/large/0085EwgIgy1goen1buk79j30hs0e60ut.jpg)



>1.用户点击页面的URL
>
>2.浏览器向DNS发出解析IP地址的请求
>
>3.DNS返回IP地址
>
>4.和该服务器进行TCP连接
>
>5.发出HTTP请求
>
>6.服务器返回HTTP响应
>
>7.关闭TCP连接

#### 特点

1.无状态。同一个用户第二次或以上访问服务器的同一个页面时，和第一次访问是没有差别的，依旧是建立TCP连接等等。

2.可靠传输：采用TCP连接

#### 报文结构

HTTP是面向文本的，因此报文段的所有字段都是ASCII码。

请求报文：

![image](https://tva1.sinaimg.cn/large/0085EwgIgy1goendfm5jtj30c207xgm7.jpg)

常见请求方法：

>1.GET：请求读取由URL标识的信息
>
>2.POST：向服务器添加信息
>
>3.HEAD：请求读取由URL标识的信息的头部
>
>4.CONNECT：用于来历服务器

响应报文：

![image-20210310112726216](C:\Users\daniel\AppData\Roaming\Typora\typora-user-images\image-20210310112726216.png)

#### HTTP事务

http事务 = 请求命令  +  返回结果

是http请求的最小处理单位。

#### 请求报文

结构：请求行   + 请求头部 + 空行  + 报文主体

![image](https://tva1.sinaimg.cn/large/0085EwgIgy1gof352t4zzj30jv09ljv1.jpg)

#### 响应报文

结构：响应行 + 响应头部  + 空行 + 报文主体 

#### 工作流程

>1.域名解析
>
>查看浏览器缓存->查看本地域名服务器->查看host文件->向本地域名服务器发起查询请求
>
>2.TCP三次握手
>
>3.发起http请求
>
>4.服务器响应并返回html
>
>5.浏览器解析html
>
>6.渲染页面

#### GET和POST对比

GET：从指定的资源中获取数据

POST：向指定的资源提交数据

![image](https://tvax3.sinaimg.cn/large/0085EwgIgy1gof3eljedlj30sq0juwgl.jpg)

GET：可保存在书签，可重复提交，可保存在浏览器缓存，对数据长度有限制，只允许ASCII码

POST：提交时应询问用户，不会存在浏览器的缓存中，不能收藏在数千，数据不会显示在url中，较为安全。

### HTTPS

加密版本的http协议。

HTTPS = HTTP  + SSL/TSL

#### SSL/TSL

##### 加密

###### 对称加密

加密与解密使用的是同一个密钥。

常用加密算法：DES(比较垃圾的)，AES(DES升级版，常用)，ChaCha20.

问题：怎么把密钥发送给对方来解密？如果密钥被截取，那就再无加密可言。

非对称加密解决了这个问题。

![image](https://tva1.sinaimg.cn/large/0085EwgIgy1gog6umu8hfj30fm06sjs1.jpg)

###### 非对称加密

明文使用公钥加密，密文使用私钥解密。

对称加密速度快，但是不安全；

非对称加密安全，但是运算速度慢。

常用非对称加密算法：RSA，ECC

![image](https://tva3.sinaimg.cn/large/0085EwgIgy1gog6vunuaxj30ge0a7ab3.jpg)

##### 加密实现

TLS使用对称加密和非对称加密结合。

![image](https://tvax3.sinaimg.cn/large/0085EwgIgy1gog712n9exj30ev0a0gni.jpg)

具体实现：

>1.用非对称加密，对公钥进行加密。
>
>2.得到加密后的公钥，相当于是对称加密的密钥。这时候用这个当作对称加密的密钥，对明文进行加密
>
>3.接收方通过密钥对非对称加密进行解密，得到对称加密的密钥
>
>4.通过对称加密的密钥解密，获得明文。

优点：解决了对称加密无法传递密钥的问题。

##### 摘要算法

尽管加密了，但还是不安全。

黑客虽然拿不到会话密钥，无法破解密文，但可以通过窃听收集到足够多的密文，再尝试着修改、重组后发给网站。因为没有完整性保证，服务器只能“照单全收”，然后他就可以通过服务器的响应获取进一步的线索，最终就会破解出明文。

另外，黑客也可以伪造身份发布公钥。如果你拿到了假的公钥，混合加密就完全失效了。你以为自己是在和“某宝”通信，实际上网线的另一端却是黑客，银行卡号、密码等敏感信息就在“安全”的通信过程中被窃取了。

所以需要在加密的基础上进行完整性，身份认证等。

**摘要算法：**将任意长度的数据压缩成固定长度，且独一无二的摘要文字。

也就是说，摘要算法依赖与算法，而不是密钥，加密后不能逆向推导。

![image](https://tvax4.sinaimg.cn/large/0085EwgIgy1gog7afd03xj30c30bm3zc.jpg)

由于它是基于类似哈希表的key-value的映射关系，因此必然存在冲突。所以TLS一般用摘要算法来生成随机数。

目前使用的摘要算法：SHA-2

通俗的来说：你发送了条消息，“转账100”，然后附上摘要，那么网站收到后就会比如消息摘要，将二者对比。只要有人恶意更改，就相当于“key-value”中的key被修改了，那必定会导致比对失败而不允许。

**但是摘要算法不具备机密性，所以需要和明文一起加密，再发送**。

![image](https://tva2.sinaimg.cn/large/0085EwgIgy1gog7ex5ivpj30jh076abg.jpg)

##### 数字签名

尽管通过加密和摘要算法已经很安全，但还可以恶意伪装成网站或者用户签发消息。

因此需要数字签名的帮助。

**数字签名：**私钥加密，公钥解密。和加密的“公钥加密，私钥解密反过来了”。

意思就是，我先用私钥将签名进行加密，防止你能通过手段去篡改，然后把数字签名和用于解密的公钥公开，接收到的时候进行解密，然后比对是否是正确的信息。如果是的话，那就说明，这条消息确实是你发的。

![image](https://tvax4.sinaimg.cn/large/0085EwgIgy1gog7pjyk8ej30gp0exdhv.jpg)

##### 数字证书和CA

目前已经使用了对称、非对称加密，摘要算法，但还是不安全！

还缺少对公钥签发者的问题。需要防止他人恶意伪造公钥。

**CA：证书认证机构。**相当于是公安局，可信度高，由他来签发公钥，是可信的。

CA发公钥，并附上序列号，用途，有效时间等等，就成了**数字证书**。

签发的可信程度：DV < OV < EV

#### 建立连接

输入https开头的url时，会发生：

>1.从url中提取出协议与域名
>
>2.使用443端口号(https默认端口)，使用DNS进行域名解析，获取到目的IP。
>
>3.使用三次握手，和服务器进行TCP连接。
>
>4.在http中，此时已经可以发送报文。但https还需要进行一次握手，在TCP上建立安全连接，此时才会发送HTTP报文

#### TLS协议

组成：

>1.记录协议：规定了TLS收发数据的单位：记录
>
>2.警报协议：向对方发送警报信息。比如版本不匹配，证书有问题等。
>
>3.握手协议：浏览器和服务器会协商好信息，交换证书和密钥。
>
>4.变更密码协议：通知对方，后续数据都使用加密保护

###### ECDHE握手

![image](https://tvax2.sinaimg.cn/large/0085EwgIgy1gog86cqt13j30ib0h4n1g.jpg)

>1.**客户端发送Client Hello**。相当于给服务器发招呼。里面声明了客户端版本号，支持的**密码加密方式**，**还有一个随机数。**(随机数用于生成会话密钥)
>
>2.服务器回应**Server Hello**。回应客户端的招呼。里面表明了接下来使用的**加密方式**，**TLS版本号**，**以及随机数**
>
>3.服务器发送 **Server Certificate**。发送数字证书，表明自己的身份。
>
>4.服务器发送 **Server Key Exchange**。相当于我刚刚选择的算法，需要这个参数才能解密，你得拿着。并附上私钥签名认证。所以这次发送了：**公钥（Server Params，私钥签名认证**
>
>5.服务器发送**Server Hello Done**。说明：我说完了，你可以开始处理了。
>
>​		这一过程下来，客户端和服务器共享了三个信息：**客户端产生的随机数(Client Random)，服务器产生的随机数(Server Random)，服务器的公钥(Server Params)**

------------------------------------------------------------------------------------------------

![image](https://tvax3.sinaimg.cn/large/0085EwgIgy1gog8k6f13lj30gk0m9td9.jpg)

客户端获取了证书后，就开始通过证书来验证其真实性，再用证书公钥验证签名，从而保证服务器的身份是对的。验证成功后，接下来：

>1.客户端发送**“Client Key Exchange”**.其中包含了**公钥(Client Params)**。这时客户端和服务器都拥有了**Client Params，Server Params**。使用ECDHE算法计算后，得到**Pre-Master**。这时候客户端和服务器都拥有的随机数(**Client Random, Server Random, Pre-Master**)，就可以用户生成**加密会话的密钥**(**Master Secret**).
>
>2.客户端发送**Change Cipher Spec和Finished**。表明之后的数据都要使用加密通信，并附上了摘要。
>
>3.服务器发送**Changer Cipher Spec和Finished**。表示我验证了你的加密解密，可以开始通信
>
>最后就可以发送http报文了。

## 面经

### TCP/IP

**1.介绍一下TCP和UDP？**

>·TCP面向连接，UDP不面向连接
>
>·TCP保证可靠传输，UDP是尽最大交付
>
>·TCP面向字节流，UDP面向报文段
>
>·TCP有拥塞控制，UDP没有拥塞控制，可用于直播等
>
>·TCP头部20个字节，UDP头部8个字节，在计算校验和时需要加上伪头部
>
>·TCP连接开销大，速度比UDP慢
>
>·TCP支持全双工通信，发送方和接收方都有缓存

**2.介绍三次握手和四次挥手？**

三次握手：

>1.客户端向服务器发送连接请求：SYN  = 1，代表连接请求。seq = x
>
>2.服务器收到连接请求，回复SYN = 1，ACK =1 ，ack = x +1，seq = y。代表服务器收到了连接请求，并开始为连接分配资源。ack表示希望下次收到的序列号为x+1
>
>3.客户端收到回复后 发送ACK = 1，ack = y + 1，seq = x + 1.代表收到了你的确认消息。

四次挥手：

>1.客户端向服务器发送断开连接请求：FIN =1 ，seq = u
>
>2.服务器收到断开连接请求，回复确认收到：seq = v，ACK = 1，ack = u + 1。这时候服务器进入到Close-wait状态，即TCP告诉应用程序，客户端向服务器的方向已经没有数据要发送了，但服务器向客户端发送信息，客户端仍要接收。
>
>3.服务器向客户端说明自己已经完成数据的发送，可以断开连接：FIN = 1，ack = u + 1，seq = w，ACK = 1
>
>4.客户端回复确认收到服务器断开的消息：ACK = 1，ack = w + 1，seq = u + 1，客户端处于Time-wait状态。这时候TCP连接还是没有释放，必须等到2*MSL才能释放连接。而服务器接收到确认报文后，就关闭了。

**3.为什么三次回收中，客户端要进行最后一次挥手？**

  > 防止失效的请求连接报文又申请新的连接。例如如果使用和两次握手，客户端发送的第一个请求没有丢失，而是经过了很长时间才到达。由于服务器并没有收到请求，就不可能进行确认报文的回复，相应的客户端也收不到确认报文，则通过超时重传机制，再次发送这个连接的报文，导致建立了新的连接，并传输了数据然后断开。这时候之前的连接请求报文才到达，服务器以为是新的连接请求，但 其实是无效的，却仍然建立了连接，这就导致了资源的浪费和错误。
  >
  >​		如果使用三次握手，就算服务器收到了这条无效的请求连接报文，就会回复这条报文的确认请求报文，而客户端是不会回应的。这时候服务器就能知道是无效的连接啦。

**4.为什么最后客户端要等待2*MSL？**

>1.保证客户端的最后一次挥手的信息能成功发送到服务器。当服务器发送了第三次挥手后，1MSL内没收到第四次挥手，就重新发第三次握手来等待客户端的第四次挥手。而客户端存活时间是2MSL，就能回复第四次挥手。并且会重置客户端存活时间为2MSL
>
>2.保证这次连接的报文全都失效后再关闭，防止下次连接出现旧的连接报文。

**5.TCP协议怎么保证可靠传输？**

>1.将数据包视为字节流，并对字节流编号，在传输的时候会表明自己的序号(seq)以及下次期望收到报文的序号(ack)。
>
>2.有重传机制。分为超时重传和冗余ACK。超时重传是指超过某一时间后收不到确认报文就会重传；冗余ACK用于说明自己收到的报文是否正确且有序。比如A发送1，2，3，4，5报文，而B收到的却是1，3，4，5.那么3，4，5都会发送一个冗余ACK为1的报文，冗余ACK为三个时判定传输出现错误，于是就会重传该ACK后的那个报文，即2.

**6.TCP的流量控制？**

>TCP接收方缓存设置了接收窗口，规定了能接受的字节数。当来不及接收发送方的数据时，会提醒对方降低速率，即调整接收窗口的数量， 让发送方改变速率。

**7.TCP如何实现拥塞控制？**

有两种算法来实现：慢开始和拥塞避免；快重传和快恢复

>慢开始和拥塞避免：首先规定发送窗口的大小为1，每次变成之前的两倍。达到阈值的时候改用每次加一，直到出现网络拥塞，就将发送窗口置为1，阈值设为原来的一般，重新开始。
>
>快重传和快恢复：
>
>快重传：当收到三个冗余ACK时，不再等待某个报文段的计时器超时，而是直接重传。
>
>快恢复：当收到三个冗余ACK时，将慢开始的阈值设为原来的一半，也将拥塞窗口的当前值设为慢开始阈值的一半，而不是像慢开始算法那样从1开始.

**8.TCP粘包**

>什么是粘包?
>
>TCP发送的数据有可能在接收方出现了前一个数据的尾部和后一个数据的头部相连，导致接收方无法识别。
>
>为什么会发生TCP粘包？
>
>发送方：使用了Nagle算法：只有上一个分组确认时，才会发送下一个分组；收集多个小分组，组成一个大的数据包一起发送。这就导致了可能会发生粘包的现象
>
>接收方：接受的速度大于应用层从缓存读取的速度，导致缓存中存在多个数据包。
>
>什么时候需要处理TCP粘包？
>
>数据不具有关联性时，需要处理TCP粘包。(关联性：比如一个文件分成了很多的字节流进行发送，那么即使粘包了也不需要处理)
>
>怎么处理TCP粘包？
>
>1.发送方：关闭Nagle算法：TCP_NODELAY
>
>2.接收方：无法处理
>
>3.应用层：从缓存中读取分组时，就应该读取完所有的指令。这对指令有要求：如果不声明或者限制指令的长度，还是会失败。
>
>对指令的处理：
>
>1.声明指令的开始部分和结束部门(可以使用特定的二进制规定)，但是这同时也导致了数据包不能出现对应的开始符号和结束符号
>
>2.每条指令的长度在指令的头部进行声明

**9.UDP会粘包？**

不会。UDP采用的是发送消息，接收方每次只接收一个消息，这就导致了不会发生粘包。

### HTTP

**1.域名解析的过程？**

>​		先在缓存中寻找是否有该IP地址。没有的话向本地域名服务器发送查询请求。本地域名服务器向根域名服务器发送请求。这是将任务分给根域名服务器，如果有的话就返回给客户机，没有的话向顶级域名服务器请求。同理再到权限域名服务器。这就是递归的方法。
>
>​		迭代：引路。本地->根域名服务器，告诉你该去哪找->本地域名服务器找到顶级域名服务器，告诉你该去哪找->本地域名服务器找权限域名服务器，得到IP地址。

**2.网站中输入url再到网页回显的过程？**

>先解析url，找到服务器的IP地址。浏览器向web服务器提交一个http请求，这时候cookie也会一起发送过去。服务器接收到请求后，处理请求，返回一个html响应，浏览器渲染html产生页面。

**3.http状态码？**

1xx：接收的请求正在处理

2xx：请求处理成功

3xx：重定向状态码。需要进行附加操作才能完成请求

4xx：服务器无法处理请求，客户端请求的方法有误

5xx：服务器处理请求出错



>200：请求访问成功
>
>301：资源被永久的移到了某个url
>
>302：资源被临时 移动到某个url
>
>303：查看其他地址
>
>400：客户端请求的语法错误，服务器无法理解
>
>401：需要用户进行身份认证
>
>402：保留，将来使用
>
>403：理解请求，但拒绝执行这次请求
>
>404：页面不存在
>
>405：请求的方法被禁止了
>
>500：服务器内部出错
>
>501：不支持该请求功能，无法完成请求
>
>502：网关或者代理的服务器执行请求时，收到了无效的响应
>
>503：由于超载或系统维护，系统暂时无法处理请求
>
>504：网关或服务器，无法从远端服务器获取请求



**4.HTTP的长连接与短连接？**

http1.0使用的是短连接。有请求时就建立连接，等请求结束后马上就断开连接。每访问一次资源，都要进行一个会话连接。

而1.1开始，使用长连接，设置keep-alive。网页打开后客户端和服务器之间的tcp连接不会断开，继续访问时会继续使用之前的tcp连接。keep-alive也有时间限制，可以设定。

**5.说说HTTP的特点？**

1.基于TCP连接

2.无状态连接，不记录客户端的状态

**6.HTTP请求的类型？**

>1.PUT：用客户端的数据来更改服务器中指定页面的内容
>
>2.GET：获取某个页面的信息
>
>3.POST：向指定资源提交添加数据的请求
>
>4.DELETE：删除某个页面

**6.防止跨站攻击？**

>1.关键的操作使用POST请求
>
>2.Token要随机，最好每次完成请求后都刷新token

**7.断点续传？**

客户端发送的请求方法，头部加入片段：Ranger：xxx-





### HTTPS

**1.说说HTTPS？**

经过SSL/TLS加密的HTTP。

![image](https://tva3.sinaimg.cn/large/0085EwgIgy1goewfy0ea0j30kw06g75k.jpg)

**2.为什么HTTP不安全？**

http属于明文传输，不对数据进行加密，也不对发送方和接收方进行验证。信息容易被劫持，监听，篡改。