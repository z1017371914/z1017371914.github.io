## 表空间的回收

为什么将表的数据删掉后，发现表文件的大小还是没有变化？

这就需要了解表的空间回收问题。

- 表数据可以存在共享的空间，也可以存在单独的文件
  - 存在单独的文件，drop tables时会`直接删除`，释放掉空间
  - 存在共享空间时，`不会马上回收`

但是，如果只删除一行，空间不会回收的话不是会出现问题吗？

因此，需要了解一下InnoDB对数据的删除流程

### 数据删除流程

![image](https://tvax2.sinaimg.cn/large/0085EwgIgy1gtfeimezncj60g20cy40302.jpg)

如果需要删除InnoDB这张数据页的R4，并不会将其释放掉，而是标记为`可复用`，当新的数据进入到R4的位置时，可以直接覆盖其位置，写入自己的内容。

### 数据插入流程

不光是删除，插入数据也是会使用复用机制

![image](https://tvax2.sinaimg.cn/large/0085EwgIgy1gtfen3xjezj60mx0rxn3n02.jpg)

向满了的PageA插入数据，会开辟新的数据页。进行页分裂后，Page A就会**有没被用到的地方**。

而把这些没被用到的地方去掉，就能释放表空间，达到表收缩的目的。

而这一手段，叫做`重建表`

