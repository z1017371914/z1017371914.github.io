<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**  *generated with [DocToc](https://github.com/thlorenz/doctoc)*

- [Java运行时数据区域](#java%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F)
  - [程序计数器](#%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8)
  - [Java虚拟机栈](#java%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88)
  - [本地方法栈](#%E6%9C%AC%E5%9C%B0%E6%96%B9%E6%B3%95%E6%A0%88)
  - [Java堆](#java%E5%A0%86)
    - [新生代](#%E6%96%B0%E7%94%9F%E4%BB%A3)
    - [老年代](#%E8%80%81%E5%B9%B4%E4%BB%A3)
  - [方法区](#%E6%96%B9%E6%B3%95%E5%8C%BA)
    - [运行时常量池](#%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# Java运行时数据区域

Java虚拟机在执行Java程序的过程中会把它所管理的内存划分为若干个不同的数据区域。根据《Java虚拟机规范（Java SE 7版）》的规定，Java虚拟机所管理的内存将会包括以下几个运行时数据区域，如下图所示：

![](../img/01/01_01_jvm_runtime_data.png)

一般来说，我们所说的运行时数据区域包括：程序计数器、方法区、堆、虚拟机栈、本地方法栈。

## 程序计数器

程序计数器是每个线程所独有的一块内存区域，它是当前线程锁执行字节码的行号指示器。这个计数器记录的是正在执行的虚拟机字节码指定的地址，字节码解释器工作时通过改变这个计数器的值来选择下一条需要执行的字节码指令。

## Java虚拟机栈

与程序计数器一样，Java虚拟机栈也是线程私有的，它的生命周期与线程相同。虚拟机栈描述的是Java方法执行的内存模型：每个方法在执行的同时都会创建一个栈帧用于存储局部变量表、操作数栈、动态链接、方法出口等信息。每个方法从调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中从入栈道出栈的过程。

在Java虚拟机规范中，对这个区域规定了两种异常情况：如果线程请求的栈深度大于虚拟机锁允许的深度，将跑出 StackOverflowError 异常。如果虚拟机栈可以动态扩展内存，但扩展时无法申请到足够的内存，则会跑出OutOfMemoryError异常。

## 本地方法栈

本地方法栈与虚拟机栈所发挥的作用是非常相似的，它们之间的区别不过是虚拟机栈为虚拟机执行Java方法服务，而本地方法栈则为虚拟机使用到的Native方法服务。与虚拟机栈一样，本地方法栈也会跑出StackOverflowError异常和OutOfMemoryError异常。

## Java堆

Java堆是被所有线程共享的一块内存区域，在虚拟机启动的时候创建，所有**对象实例和数组**都在堆上分配内存。

从内存回收的角度上看，Java堆可以细分为：新生代和老年代。

### 新生代

新生代主要用于为新创建的对象分配内存，如果对象过大，那么对象将会直接在老年代分配内存，因此新生代内存区存放的对象大多都是比较年轻的。新生代还可以分为：Eden空间、From Survivor空间、To Survivor空间。

### 老年代

在每次进行垃圾回收时，垃圾回收器会判断对象的存活时间，如果对象已经存活很久了，那么垃圾回收器将会把他移动到老年代内存区，因此老年代内存区的对象大多数都是比较老的。

Java堆在内存不足的时候，也同样会跑出OutOfMemoryError异常。

## 方法区

方法区于Java堆一样，是各个线程共享的内存区域，它用于存储已被虚拟机加载的类信息、常量、静态变量、即使编译器编译后的代码等数据。在HotSpot虚拟机中，它经常被人称为“永久代”。

当方法去无法满足内存分配需求时，也将抛出OutOfMemoryError异常。

### 运行时常量池

运行时常量池是方法去的一部分。Class文件中除了有类的版本、字段、方法、接口等描述信息外，还有一项信息是常量池，用于存放编译器生成的各种字面量和符号引用，这部分内容将在类加载后进入方法区的运行时常量池中存放。
